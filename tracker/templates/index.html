{% extends "base.html" %}

{% block title %} 
<div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li><a class="brand" href="/">IRE impact tracker</a></li>
                    <li><a href="/training/">Our training</a></li>
                    <li><a href="/impacts/">How we impact stories</a></li>
                    <li><a href="/articles/">Articles we've assisted</a></li>
                    <li><a href="/share/">Share a story</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
      </div>
</div>

{% endblock %}

    
{% block body %}

<div class="row-fluid">
<div class="container span12">

    <div class="row-fluid">
        <div class="span10 offset1">
            <p class="lead">IRE's training, data analysis services and open-source tools such as DocumentCloud have contributed to hard-hitting journalism around the world.</p>
        </div>
    </div>

    <div class="row-fluid">
                <div class="span6 offset1">
                    <div class="page-header">
                        <h3>Training map</h3>
                        <p>The map below shows locations of IRE training over the past five years. Click on an icon to see details of the training, including any stories it made possible. </p>
                    </div>
                    <div id="map" style="height:400px; width:100%; box-shadow: 4px 4px 5px #ccc;">

                        <script src='/mapjson/'></script>
                        <script type="text/javascript">

                            var map = L.map('map').setView([38.972180,-96.316170], 3);
                            
                            L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                maxZoom: 18,
                                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>'
                            }).addTo(map);

                            /* var coordinates = data.features.geometry.coordinates;

                            L.marker([coordinates]).addTo(map);

                            L.geoJson(someFeatures).addTo(map);

                            */
                            function getPoints(selectObj) {
                                    removeMarkers();
                                    var markers = [];
                                    $.getJSON('/mapjson/', function(data) {
                                        for (var i = 0; i < data.length; i++) 
                                            {

                                                
                                                markers.push(L.marker([data[i].lat, data[i].lng]).bindPopup(
                                                    "<b>" + data[i].year + ' ' + data[i].type + ' in ' + data[i].city +  '</b>'+ '<br />' +  '<em> Hosted by ' + data[i].host + '</em>' + '<br />' + '<br />' + '<a href="/training/' + data[i].slug + '">' + '<b>' + 'Learn more about this training' + '</a>' + '</b>'));
                                            
                                            //html += '<div class="item">' + '<a href="' + link + '" target="_blank">' + text + '</a></div>';
                                                 
                                        }

                                        var markerLayer = L.layerGroup(markers);
                                        map.addLayer(markerLayer);
                                        activelayers.push(markerLayer);
                                    }); 
                                }

                            var activelayers = [];

                            function removeMarkers() {
                                for (i=0;i<activelayers.length;i++) {
                                    map.removeLayer(activelayers[i]);
                                }
                                activelayers=[];
                            }

                            getPoints();
                        </script>
                    </div>

                </div>
                
                <div class="span4">
                    <div class="page-header">
                        <h3>Latest articles</h3>
                        <p>Recent investigative stories that IRE made possible.</p>
                    </div>
                    <div id="index-storylist">
                                {% for a in articles %}
                                <h4><a href="/articles/{{ a.slug }}">{{ a.headline }}</a><br />
                                {{ a.organization }} </h4>
                                <p>By <em>{{ a.byline}},</em> published {{ a.date|date:"M d, Y"  }} </p>
                                <p>{{ a.description|safe }}<br />
                                <em>IRE contributed:{% for impact in a.impact.all %} <a href="/impacts/{{ impact.slug }}"> {{ impact.name|lower }}</a>{% if not forloop.last %}, {% endif %} {% endfor %}</em>
                                </p>
                                <hr />
                                {% endfor %}
                            </ul>       
                    </div>
                </div>

    <div class="row-fluid">
        <div class="span12"></div>
    </div>

    </div>
</div>
</div>


</div>
{% endblock %}





